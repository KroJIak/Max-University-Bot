# Запуск mini-app без Docker

Инструкция по локальной разработке и запуску мини-приложения без использования Docker.

## Требования

- **Node.js** версии 20 или выше
- **npm** (устанавливается вместе с Node.js)
- Операционная система: Linux, macOS или Windows

## Установка Node.js и npm

### Linux (Ubuntu/Debian)

```bash
# Обновляем список пакетов
sudo apt update

# Устанавливаем Node.js и npm через NodeSource (рекомендуется)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Проверяем установку
node --version
npm --version
```

### Linux (через snap)

```bash
# Устанавливаем Node.js через snap
sudo snap install node --classic

# Проверяем установку
node --version
npm --version
```

### macOS

```bash
# Используем Homebrew (если установлен)
brew install node

# Или скачайте установщик с официального сайта:
# https://nodejs.org/
```

### Windows

1. Скачайте установщик с официального сайта: https://nodejs.org/
2. Выберите версию LTS (20.x или выше)
3. Запустите установщик и следуйте инструкциям
4. Проверьте установку в командной строке:
   ```cmd
   node --version
   npm --version
   ```

## Установка зависимостей проекта

1. **Перейдите в директорию mini-app:**
   ```bash
   cd mini-app
   ```

2. **Установите зависимости:**
   ```bash
   npm install
   ```
   
   > Эта команда установит все зависимости, указанные в `package.json`, в папку `node_modules`.

3. **Проверьте, что зависимости установлены:**
   ```bash
   ls node_modules
   ```

## Настройка переменных окружения (опционально)

По умолчанию приложение запускается на `http://localhost:8002`. Если нужно изменить хост или порт, создайте файл `.env` в директории `mini-app`:

```bash
# Создаем файл .env
cat > .env << EOF
MINI_APP_HOST=0.0.0.0
MINI_APP_PORT=8002
EOF
```

Или отредактируйте файл вручную:
```bash
nano .env
```

Добавьте:
```
MINI_APP_HOST=0.0.0.0
MINI_APP_PORT=8002
```

## Запуск приложения

### Режим разработки (Development)

```bash
# Запуск dev сервера
npm run dev
```

Приложение будет доступно по адресу:
- **Локально**: `http://localhost:8002`
- **В сети**: `http://<ваш-ip>:8002` (если MINI_APP_HOST=0.0.0.0)

> Dev сервер автоматически перезагружает страницу при изменении файлов (Hot Module Replacement).

### Запуск с указанием хоста и порта

```bash
# Запуск на конкретном хосте и порту
npm run dev -- --host 0.0.0.0 --port 8002
```

### Сборка для продакшена

```bash
# Сборка проекта
npm run build

# Предпросмотр собранной версии
npm run preview
```

Собранные файлы будут находиться в папке `dist/`.

## Проверка работы

1. **Откройте браузер** и перейдите по адресу `http://localhost:8002`
2. **Проверьте консоль** в терминале — должны быть сообщения о запуске сервера
3. **Проверьте консоль браузера** (F12) — не должно быть ошибок

## Полезные команды

```bash
# Проверка версии Node.js и npm
node --version
npm --version

# Проверка установленных зависимостей
npm list

# Обновление зависимостей
npm update

# Очистка кэша npm
npm cache clean --force

# Удаление node_modules и переустановка зависимостей
rm -rf node_modules package-lock.json
npm install

# Проверка кода линтером
npm run lint

# Запуск с автоматическим исправлением ошибок линтера
npm run lint -- --fix
```

## Устранение проблем

### Ошибка: "command not found: node" или "command not found: npm"

**Решение:**
1. Убедитесь, что Node.js установлен: `node --version`
2. Если не установлен, следуйте инструкциям по установке выше
3. Перезапустите терминал после установки

### Ошибка: "EACCES: permission denied"

**Решение:**
```bash
# Не используйте sudo для npm install!
# Вместо этого настройте права на директорию npm:
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
export PATH=~/.npm-global/bin:$PATH
```

Добавьте в `~/.bashrc` или `~/.zshrc`:
```bash
export PATH=~/.npm-global/bin:$PATH
```

### Ошибка: "Port 8002 is already in use"

**Решение:**
```bash
# Найти процесс, использующий порт
lsof -i :8002
# Или
netstat -tulpn | grep 8002

# Остановить процесс или использовать другой порт
npm run dev -- --port 8003
```

### Сайт не загружается по IP адресу (например, http://192.168.3.46:5175)

**Симптомы:**
- Сервер запущен и показывает, что доступен по IP адресу
- `curl http://192.168.3.46:5175` работает (возвращает HTML)
- Но браузер не загружает страницу или показывает ошибки

**Причина:**
Проблема обычно связана с тем, что Vite использует WebSocket для Hot Module Replacement (HMR), и браузер может блокировать WebSocket соединения или не может загрузить JavaScript модули через IP адрес.

**Решение:**

1. **Перезапустите dev сервер после обновления конфигурации:**
   ```bash
   # Остановите сервер (Ctrl+C в терминале, где запущен npm run dev)
   # Затем запустите снова
   npm run dev
   ```

2. **Проверьте консоль браузера:**
   - Откройте DevTools (F12)
   - Перейдите на вкладку **Console** и посмотрите на ошибки
   - Перейдите на вкладку **Network** и проверьте, какие запросы блокируются
   - Особенно обратите внимание на WebSocket соединения (ws://)

3. **Проверьте firewall (если проблема сохраняется):**
   ```bash
   # Проверить статус firewall
   sudo ufw status
   # Или
   sudo firewall-cmd --list-all
   
   # Открыть порт для HTTP (если нужно)
   sudo ufw allow 5175/tcp
   # Или
   sudo firewall-cmd --add-port=5175/tcp --permanent
   sudo firewall-cmd --reload
   ```

4. **Используйте localhost (если проблема с IP адресом):**
   - Если доступ к серверу с другого устройства не критичен, используйте `http://localhost:5175`
   - Или используйте SSH туннель для доступа к серверу:
     ```bash
     # На клиентской машине
     ssh -L 5175:localhost:5175 user@192.168.3.46
     # Затем откройте http://localhost:5175 в браузере
     ```

5. **Проверьте конфигурацию Vite:**
   - Убедитесь, что в `vite.config.ts` указан `host: '0.0.0.0'`
   - Проверьте, что конфигурация сохранена и сервер перезапущен

6. **Временное решение - отключить HMR:**
   - Если проблема только с HMR (Hot Module Replacement), можно временно отключить его:
   - Но это не рекомендуется, так как потеряете возможность автоматической перезагрузки

7. **Проверьте настройки безопасности браузера:**
   - Некоторые браузеры блокируют смешанный контент (HTTP/HTTPS)
   - Проверьте настройки безопасности браузера
   - Попробуйте другой браузер

**Диагностика проблемы:**
```bash
# 1. Проверьте, что сервер действительно слушает на всех интерфейсах
netstat -tlnp | grep 5175
# Должно показать: 0.0.0.0:5175 или *:5175

# 2. Проверьте доступность через curl
curl -v http://192.168.3.46:5175
# Должен вернуть HTML страницу

# 3. Проверьте доступность через curl с вашего IP
curl -v http://localhost:5175
# Должен вернуть HTML страницу

# 4. Проверьте WebSocket соединение (если есть инструменты)
# Vite использует WebSocket на том же порту для HMR
```

### Ошибка: "Cannot find module" или "Module not found"

**Решение:**
```bash
# Переустановите зависимости
rm -rf node_modules package-lock.json
npm install
```

### Ошибка: "npm ERR! code ELIFECYCLE"

**Решение:**
```bash
# Очистите кэш и переустановите зависимости
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### Медленная работа npm install

**Решение:**
```bash
# Используйте альтернативный менеджер пакетов (yarn или pnpm)
# Или используйте зеркало npm:
npm config set registry https://registry.npmmirror.com
```

### Ошибки TypeScript

**Решение:**
```bash
# Проверьте версию TypeScript
npx tsc --version

# Переустановите TypeScript
npm install --save-dev typescript@latest

# Проверьте конфигурацию TypeScript
cat tsconfig.json
```

## Структура проекта

```
mini-app/
├── src/                 # Исходный код приложения
│   ├── components/      # React компоненты
│   ├── pages/           # Страницы приложения
│   ├── layout/          # Layout компоненты
│   └── shared/          # Общие типы и утилиты
├── node_modules/        # Зависимости (не коммитится в git)
├── dist/                # Собранные файлы (после npm run build)
├── package.json         # Конфигурация проекта и зависимости
├── vite.config.ts       # Конфигурация Vite
├── tsconfig.json        # Конфигурация TypeScript
└── .env                 # Переменные окружения (создать вручную)
```

## Разработка

### Hot Module Replacement (HMR)

При изменении файлов в `src/`, страница автоматически перезагружается в браузере. Это позволяет быстро видеть изменения без перезапуска сервера.

### Редактирование файлов

1. Откройте файл в редакторе (VS Code, WebStorm и т.д.)
2. Внесите изменения
3. Сохраните файл
4. Страница автоматически обновится в браузере

### Отладка

1. **В браузере**: Откройте DevTools (F12) и используйте консоль для отладки
2. **В коде**: Используйте `console.log()` для вывода информации
3. **В VS Code**: Установите расширение "Debugger for Chrome" для отладки

## Остановка приложения

Для остановки dev сервера нажмите `Ctrl + C` в терминале, где запущен сервер.

## Дополнительная информация

- **Документация Vite**: https://vitejs.dev/
- **Документация React**: https://react.dev/
- **Документация TypeScript**: https://www.typescriptlang.org/
- **Документация npm**: https://docs.npmjs.com/

## Быстрый старт

```bash
# 1. Установите Node.js (если еще не установлен)
node --version

# 2. Перейдите в директорию проекта
cd mini-app

# 3. Установите зависимости
npm install

# 4. Запустите dev сервер
npm run dev

# 5. Откройте браузер и перейдите на http://localhost:8002
```

## Примечания

- При работе без Docker убедитесь, что API сервер также запущен и доступен
- Если API запущен в Docker, убедитесь, что порты доступны для подключения
- Для работы с API может потребоваться настройка CORS на стороне API сервера
- В режиме разработки используется dev сервер Vite, который не предназначен для продакшена
- Для продакшена используйте `npm run build` и разверните файлы из папки `dist/` на веб-сервере

